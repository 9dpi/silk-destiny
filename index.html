<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Silk of Destiny v2.2 - Advanced UX</title>
    <style>
        :root {
            --gold: #c5a059;
            --dark: #050505;
            --white: #e0e0e0;
            --purple: #a066ff;
            --glass: rgba(10, 10, 10, 0.98);
        }

        ::-webkit-scrollbar {
            width: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold);
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--dark);
            color: var(--white);
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
        }

        /* SIDEBAR */
        #sidebar {
            width: 380px;
            min-width: 380px;
            background: #080808;
            border-right: 1px solid rgba(197, 160, 89, 0.1);
            display: flex;
            flex-direction: column;
            z-index: 10;
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .sidebar-header {
            padding: 30px;
            border-bottom: 1px solid rgba(197, 160, 89, 0.1);
            text-align: center;
        }

        .app-title {
            color: var(--gold);
            font-weight: 300;
            letter-spacing: 6px;
            font-size: 18px;
            text-transform: uppercase;
            margin: 0;
        }

        .sidebar-scroll {
            padding: 25px 35px;
            overflow-y: auto;
            flex: 1;
        }

        .stat-group {
            padding: 20px 0;
            text-align: center;
            border-bottom: 1px solid #111;
            margin-bottom: 25px;
        }

        .label {
            font-size: 10px;
            color: #555;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .value {
            font-size: 55px;
            color: var(--gold);
            font-weight: 100;
            line-height: 1;
        }

        .section-title {
            font-size: 12px;
            color: var(--gold);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin: 30px 0 15px 0;
            font-weight: bold;
            border-left: 3px solid var(--gold);
            padding-left: 12px;
        }

        .insight-text {
            font-size: 15px;
            line-height: 1.8;
            color: #aaa;
            text-align: justify;
            margin-bottom: 25px;
            white-space: pre-line;
        }

        .sidebar-footer {
            padding: 20px 35px;
            border-top: 1px solid rgba(197, 160, 89, 0.1);
            background: #080808;
            margin-top: auto;
        }

        .reset-btn {
            background: none;
            border: 1px solid rgba(197, 160, 89, 0.3);
            color: var(--gold);
            padding: 12px;
            width: 100%;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 10px;
            transition: 0.3s;
        }

        .reset-btn:hover {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        /* NEXT STEP BUTTON (MOBILE) */
        .next-step-btn {
            display: none;
            background: var(--gold);
            color: #000;
            border: none;
            padding: 16px;
            width: 100%;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 11px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* MAIN VIEW */
        #main-view {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            background: var(--dark);
            overflow: hidden;
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .top-nav {
            height: 75px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 40px;
            z-index: 20;
            position: absolute;
            right: 0;
            top: 0;
            gap: 15px;
        }

        .phase3-btn {
            background: var(--purple);
            color: #000;
            border: none;
            padding: 12px 28px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
            border-radius: 4px;
        }

        .donate-btn {
            background: none;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 11px 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
            border-radius: 4px;
            transition: 0.3s;
        }

        .donate-btn:hover {
            background: var(--gold);
            color: #000;
        }

        .back-btn {
            display: none;
            background: none;
            border: 1px solid #333;
            color: #666;
            padding: 8px 15px;
            font-size: 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        #canvas-container {
            flex: 1;
            position: relative;
            width: 100%;
            overflow: hidden;
            transition: flex 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
            cursor: pointer;
        }

        /* TIPBOX */
        #node-tip {
            position: absolute;
            display: none;
            background: var(--glass);
            border: 1px solid var(--gold);
            padding: 10px 18px;
            border-radius: 8px;
            z-index: 2000;
            pointer-events: none;
            transform: translate(-50%, calc(-100% - 25px));
            width: 240px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .tip-year {
            font-size: 10px;
            color: var(--gold);
            display: block;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }

        .tip-label {
            font-size: 13px;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* DONATE MODAL */
        #donate-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.92);
            z-index: 6000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
        }

        .modal-content {
            background: #080808;
            padding: 40px;
            border: 1px solid rgba(197, 160, 89, 0.3);
            text-align: center;
            border-radius: 8px;
            position: relative;
            max-width: 320px;
        }

        .qr-img {
            width: 100%;
            height: auto;
            border: 2px solid #fff;
            margin: 25px 0;
            border-radius: 4px;
        }

        /* BOTTOM PANEL */
        #bottom-panel {
            height: 0;
            background: rgba(5, 5, 5, 0.98);
            border-top: 0 solid rgba(197, 160, 89, 0.3);
            padding: 0 60px;
            box-sizing: border-box;
            backdrop-filter: blur(25px);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            overflow-y: auto;
            z-index: 30;
            opacity: 0;
        }

        #bottom-panel.active {
            height: 380px;
            padding: 40px 60px;
            border-top-width: 1px;
            opacity: 1;
        }

        .panel-header {
            display: flex;
            align-items: baseline;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #222;
            padding-bottom: 15px;
        }

        .panel-year {
            color: var(--gold);
            font-size: 16px;
            font-weight: bold;
            letter-spacing: 3px;
        }

        .panel-title {
            font-size: 24px;
            color: #fff;
            font-weight: 200;
            text-transform: uppercase;
        }

        .panel-content {
            font-size: 16px;
            line-height: 2;
            color: #ccc;
            text-align: justify;
            white-space: pre-line;
        }

        /* INPUT OVERLAY */
        #input-overlay {
            position: absolute;
            inset: 0;
            background: #000;
            z-index: 5000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-card {
            width: 340px;
            text-align: center;
        }

        select,
        input {
            background: #000;
            border: 1px solid #222;
            color: var(--gold);
            padding: 14px;
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
            outline: none;
            border-radius: 4px;
        }

        .start-btn {
            background: var(--gold);
            color: #000;
            border: none;
            padding: 18px;
            width: 100%;
            text-transform: uppercase;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 3px;
            border-radius: 4px;
        }

        /* RESPONSIVE STEPS */
        @media (max-width: 1000px) {
            body {
                flex-direction: row;
                width: 200vw;
                overflow: hidden;
            }

            #sidebar {
                width: 100vw;
                min-width: 100vw;
                border-right: none;
            }

            #main-view {
                width: 100vw;
                min-width: 100vw;
            }

            .next-step-btn {
                display: block;
            }

            .back-btn {
                display: block;
                margin-right: auto;
            }

            .top-nav {
                justify-content: space-between;
                width: calc(100% - 40px);
                left: 20px;
            }

            body.show-pinnacles #sidebar {
                transform: translateX(-100vw);
            }

            body.show-pinnacles #main-view {
                transform: translateX(-100vw);
            }
        }
    </style>
</head>

<body>
    <div id="donate-modal" onclick="closeDonate()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div
                style="color:var(--gold); letter-spacing:4px; font-size:14px; margin-bottom:5px; text-transform:uppercase;">
                Gieo Duy√™n L√†nh</div>
            <img src="https://raw.githubusercontent.com/9dpi/thantoan/refs/heads/main/qr-code-tech.jpg" class="qr-img">
            <div style="font-size:12px; color:#666; line-height:1.6;">The Silk Destiny tr√¢n qu√Ω s·ª± ·ªßng h·ªô c·ªßa b·∫°n.</div>
        </div>
    </div>

    <div id="input-overlay">
        <div class="input-card">
            <h2 style="color:var(--gold); font-weight:100; letter-spacing:10px; margin-bottom:40px;">SILK</h2>
            <input type="text" id="user-name" placeholder="NH·∫¨P DANH T√çNH">
            <div style="display:flex; gap:10px; margin-bottom:20px;"><select id="birth-day"></select><select
                    id="birth-month"></select><select id="birth-year"></select></div>
            <button class="start-btn" id="main-action-btn" onclick="initDestiny()">D·ªÜT T∆† ƒê·ªäNH M·ªÜNH</button>
        </div>
    </div>

    <div id="sidebar">
        <div class="sidebar-header">
            <h1 class="app-title">The Silk Destiny</h1>
        </div>
        <div class="sidebar-scroll">
            <div class="stat-group">
                <div class="label">T·∫ßn S·ªë √ù Th·ª©c</div>
                <div class="value" id="path-val">--</div>
            </div>
            <div id="insight-section" style="display:none;">
                <div class="section-title">Ph√¢n T√≠ch B·∫£n Ng√£</div>
                <div id="path-desc" class="insight-text"></div>
                <div class="section-title">V·∫≠n Tr√¨nh NƒÉm 2026</div>
                <div id="year-insight" class="insight-text"></div>
                <button class="next-step-btn" onclick="goToPinnacles()">Xem V·∫≠n Tr√¨nh T∆∞∆°ng Lai ‚ûî</button>
            </div>
        </div>
        <div class="sidebar-footer" id="sidebar-footer" style="display:none;"><button class="reset-btn"
                onclick="clearMemory()">Khai M·ªü Danh T√≠nh M·ªõi</button></div>
    </div>

    <div id="main-view">
        <div class="top-nav">
            <button class="back-btn" onclick="goBackToInsight()">‚á† Quay l·∫°i</button>
            <button class="donate-btn" onclick="openDonate()">GIEO DUY√äN</button>
            <button class="phase3-btn">PHASE 3</button>
        </div>
        <div id="canvas-container">
            <canvas id="silkCanvas"></canvas>
            <div id="node-tip"><span class="tip-year" id="tip-year"></span><span class="tip-label"
                    id="tip-label"></span></div>
        </div>
        <div id="bottom-panel">
            <div class="panel-header"><span class="panel-year" id="p-year"></span><span class="panel-title"
                    id="p-title"></span></div>
            <div id="p-content" class="panel-content"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('silkCanvas'), ctx = canvas.getContext('2d');
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyK5GZTZitbOgavMYlKBbFVf1OmOZAs92Ql0It7_G38gY1l-h_3fb5bwlINabAdL0M5/exec";

        let silkPath = [], milestones = [], sparks = [], isLive = false, activeNode = null;
        const dS = document.getElementById('birth-day'), mS = document.getElementById('birth-month'), yS = document.getElementById('birth-year');
        for (let i = 1; i <= 31; i++) dS.add(new Option(i, i));
        for (let i = 1; i <= 12; i++) mS.add(new Option("Th√°ng " + i, i));
        for (let i = 2026; i >= 1900; i--) yS.add(new Option(i, i));

        function openDonate() { document.getElementById('donate-modal').style.display = 'flex'; }
        function closeDonate() { document.getElementById('donate-modal').style.display = 'none'; }

        // ƒêI·ªÄU H∆Ø·ªöNG B∆Ø·ªöC (MOBILE)
        function goToPinnacles() { document.body.classList.add('show-pinnacles'); setTimeout(resize, 600); }
        function goBackToInsight() { document.body.classList.remove('show-pinnacles'); }

        window.onload = () => { const s = JSON.parse(localStorage.getItem('destiny_profile')); if (s) { document.getElementById('user-name').value = s.name; dS.value = s.d; mS.value = s.m; yS.value = s.y; document.getElementById('main-action-btn').innerText = "TI·∫æP T·ª§C H√ÄNH TR√åNH"; } };
        function clearMemory() { localStorage.removeItem('destiny_profile'); document.body.classList.remove('show-pinnacles'); location.reload(); }

        async function initDestiny() {
            const name = document.getElementById('user-name').value; if (!name) return;
            document.querySelector('.start-btn').innerText = "ƒêANG D·ªÜT...";
            localStorage.setItem('destiny_profile', JSON.stringify({ name, d: dS.value, m: mS.value, y: yS.value }));
            try {
                const res = await fetch(`${SCRIPT_URL}?name=${encodeURIComponent(name)}&d=${dS.value}&m=${mS.value}&y=${yS.value}`);
                const data = await res.json(); renderDestiny(data);
            } catch (e) { alert("L·ªói k·∫øt n·ªëi!"); document.querySelector('.start-btn').innerText = "D·ªÜT T∆† ƒê·ªäNH M·ªÜNH"; }
        }

        function renderDestiny(data) {
            document.getElementById('path-val').innerText = data.masterNum;
            document.getElementById('path-desc').innerText = data.insight;
            document.getElementById('year-insight').innerText = data.yearInsight;
            milestones = data.pinnacles.map((p, i) => ({ ...p, id: i }));
            document.getElementById('insight-section').style.display = 'block';
            document.getElementById('sidebar-footer').style.display = 'block';
            document.getElementById('input-overlay').style.display = 'none';
            isLive = true; resize();
        }

        function selectNode(id) {
            activeNode = id; const m = milestones[id];

            // LOGIC TINH T·∫æ: ƒê·ªîI T√åNH DUY√äN -> GIA ƒê√åNH CHO USER NH·ªé TU·ªîI
            let finalContent = m.content;
            if (m.age < 18) {
                finalContent = finalContent.replace(/T√åNH DUY√äN|T√åNH C·∫¢M/g, "GIA ƒê·∫†O & H·ªåC T·∫¨P");
                finalContent = finalContent.replace(/üíé TI·ªÄN T√ÄI/g, "üìö TRI TH·ª®C");
            }

            document.getElementById('p-year').innerText = `${m.year} | ${m.age} TU·ªîI`;
            document.getElementById('p-title').innerText = m.label;
            document.getElementById('p-content').innerText = finalContent;
            document.getElementById('bottom-panel').classList.add('active');
            setTimeout(() => { resize(); updateTip(id); }, 600);
        }

        function updateTip(id) {
            const m = milestones[id]; const tip = document.getElementById('node-tip');
            let idx = Math.floor((id + 1) * (silkPath.length / (milestones.length + 1)));
            let p = silkPath[idx];
            tip.style.display = 'block'; tip.style.left = p.x + 'px'; tip.style.top = p.y + 'px';
            document.getElementById('tip-year').innerText = `${m.year} ‚Ä¢ NƒÉm b·∫°n ${m.age} tu·ªïi`;
            document.getElementById('tip-label').innerText = m.label;
        }

        function resize() {
            const c = document.getElementById('canvas-container');
            canvas.width = c.clientWidth; canvas.height = c.clientHeight;
            createSilkLine(); if (activeNode !== null) updateTip(activeNode);
        }
        window.onresize = resize;

        function createSilkLine() {
            silkPath = []; const seg = 200; const amp = canvas.height * 0.12;
            for (let i = 0; i <= seg; i++) silkPath.push({ x: (canvas.width / seg) * i, y: canvas.height / 2 + Math.sin(i * 0.06) * amp });
            sparks = Array.from({ length: 20 }, () => ({ pos: Math.random() * seg, speed: 0.15, size: 0.8 }));
        }

        canvas.addEventListener('click', (e) => {
            const r = canvas.getBoundingClientRect();
            const mx = (e.clientX - r.left) * (canvas.width / r.width);
            const my = (e.clientY - r.top) * (canvas.height / r.height);
            let found = -1;
            milestones.forEach((m, i) => {
                let idx = Math.floor((i + 1) * (silkPath.length / (milestones.length + 1)));
                let p = silkPath[idx]; if (Math.sqrt((mx - p.x) ** 2 + (my - p.y) ** 2) < 45) found = i;
            });
            if (found !== -1) selectNode(found);
            else { activeNode = null; document.getElementById('node-tip').style.display = 'none'; document.getElementById('bottom-panel').classList.remove('active'); setTimeout(resize, 600); }
        });

        function loop() {
            ctx.fillStyle = "#050505"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            if (isLive) {
                ctx.beginPath(); ctx.moveTo(silkPath[0].x, silkPath[0].y);
                for (let i = 1; i < silkPath.length; i++) ctx.lineTo(silkPath[i].x, silkPath[i].y);
                ctx.strokeStyle = "rgba(197, 160, 89, 0.2)"; ctx.stroke();
                sparks.forEach(s => {
                    s.pos += s.speed; if (s.pos >= silkPath.length - 1) s.pos = 0;
                    const p1 = silkPath[Math.floor(s.pos)], p2 = silkPath[Math.ceil(s.pos)];
                    if (p1 && p2) {
                        const r = s.pos % 1; const x = p1.x + (p2.x - p1.x) * r, y = p1.y + (p2.y - p1.y) * r;
                        ctx.beginPath(); ctx.arc(x, y, s.size, 0, 7); ctx.fillStyle = "rgba(197, 160, 89, 0.4)"; ctx.fill();
                    }
                });
                milestones.forEach((m, i) => {
                    let idx = Math.floor((i + 1) * (silkPath.length / (milestones.length + 1)));
                    let p = silkPath[idx];
                    if (activeNode === m.id) { ctx.beginPath(); ctx.arc(p.x, p.y, 11, 0, 7); ctx.fillStyle = "#fff"; ctx.shadowBlur = 30; ctx.shadowColor = "#fff"; ctx.fill(); ctx.shadowBlur = 0; }
                    else { ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, 7); ctx.fillStyle = "#c5a059"; ctx.fill(); }
                });
            }
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>

</html>